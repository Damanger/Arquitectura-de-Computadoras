<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>PyScript</title>
</head>
<body>
    <py-script>
        from js import document,alert

        funct7add="0000000"
        funct7sub="0100000"
        funct3="000"
        funct3bne="001"
        funct3lsd="011"
        opcode="0110011"
        opcodeld="0000011"
        opcodesd="0100011"
        opcodebe="1100011"
        opcodejal="1101111"
        opcodejalr="1100111"

        def Traducir(*args,**kwargs):
            test_text=Element("test-input").element.value
            test_text=test_text.lower().replace(',',' ').replace('(','').replace(')','').split(' ')
            final=""
            try:
                if(test_text[0]=="add"):
                    if(test_text[1][0]=="x"):
                        rd=int(test_text[1][1:])
                        if(test_text[2][0]=="x"):
                            rs1=int(test_text[2][1:])
                            if(test_text[3][0]=="x"):
                                rs2=int(test_text[3][1:])
                                rd=bin(rd).replace('0b','')
                                while(len(rd)<5):
                                    rd="0"+rd
                                rs1=bin(rs1).replace('0b','')
                                while(len(rs1)<5):
                                    rs1="0"+rs1
                                rs2=bin(rs2).replace('0b','')
                                while(len(rs2)<5):
                                    rs2="0"+rs2
                                resultado=funct7add+rs2+rs1+funct3+rd+opcode
                                final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                                final=final.replace('0x','')
                                pyscript.write("resultado",final)
                            else:
                                pass
                        else:
                            pass
                    else:
                        pass
                elif(test_text[0]=="sub"):
                    if(test_text[1][0]=="x"):
                        rd=int(test_text[1][1:])
                        if(test_text[2][0]=="x"):
                            rs1=int(test_text[2][1:])
                            if(test_text[3][0]=="x"):
                                rs2=int(test_text[3][1:])
                                rd=bin(rd).replace('0b','')
                                while(len(rd)<5):
                                    rd="0"+rd
                                rs1=bin(rs1).replace('0b','')
                                while(len(rs1)<5):
                                    rs1="0"+rs1
                                rs2=bin(rs2).replace('0b','')
                                while(len(rs2)<5):
                                    rs2="0"+rs2
                                resultado=funct7sub+rs2+rs1+funct3+rd+opcode
                                final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                                final=final.replace('0x','')
                                pyscript.write("resultado",final)
                            else:
                                pass
                        else:
                            pass
                    else:
                        pass
                elif(test_text[0]=="ld"):
                    if(test_text[1][0]=="x"):
                        rd=int(test_text[1][1:])
                        sig=test_text[2].find('x')
                        if(test_text[2][sig]=="x"):
                            rs1=int(test_text[2][sig+1:])
                            immediate=int(test_text[2][0:sig])
                            rd=bin(rd).replace('0b','')
                            while(len(rd)<5):
                                    rd="0"+rd
                            rs1=bin(rs1).replace('0b','')
                            while(len(rs1)<5):
                                rs1="0"+rs1
                            immediate=bin(immediate).replace('0b','')
                            while(len(immediate)<12):
                                immediate="0"+immediate
                            resultado=immediate+rs1+funct3lsd+rd+opcodeld
                            final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                            final=final.replace('0x','')
                            pyscript.write("resultado",final)
                        else:
                            pass
                    else:
                        pass
                elif(test_text[0]=="sd"):
                    if(test_text[1][0]=="x"):
                        rs2=int(test_text[1][1:])
                        sig=test_text[2].find('x')
                        if(test_text[2][sig]=="x"):
                            rs1=int(test_text[2][sig+1:])
                            immediate=int(test_text[2][0:sig])
                            rs1=bin(rs1).replace('0b','')
                            while(len(rs1)<5):
                                rs1="0"+rs1
                            rs2=bin(rs2).replace('0b','')
                            while(len(rs2)<5):
                                rs2="0"+rs2
                            immediate=bin(immediate).replace('0b','')
                            while(len(immediate)<12):
                                immediate="0"+immediate
                            resultado=immediate[0:7]+rs2+rs1+funct3lsd+immediate[7:]+opcodesd
                            final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                            final=final.replace('0x','')
                            pyscript.write("resultado",final)
                        else:
                            pass
                    else:
                        pass
                elif(test_text[0]=="beq"):
                    if(test_text[1][0]=="x"):
                        rd=int(test_text[1][1:])
                        if(test_text[2][0]=="x"):
                            rs1=int(test_text[2][1:])
                            if(int(test_text[3][0])%4==0):
                                rs2=int(test_text[3][0:])
                                rd=bin(rd).replace('0b','')
                                while(len(rd)<5):
                                    rd="0"+rd
                                rs1=bin(rs1).replace('0b','')
                                while(len(rs1)<5):
                                    rs1="0"+rs1
                                rs2=bin(rs2).replace('0b','')
                                while(len(rs2)<12):
                                    rs2="0"+rs2
                                resultado=rs2+rs1+funct3+rd+opcodebe
                                final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                                final=final.replace('0x','')
                                pyscript.write("resultado",final)
                            else:
                                pass
                        else:
                            pass
                    else:
                        pass
                elif(test_text[0]=="bne"):
                    if(test_text[1][0]=="x"):
                        rd=int(test_text[1][1:])
                        if(test_text[2][0]=="x"):
                            rs1=int(test_text[2][1:])
                            if(int(test_text[3][0])%4==0):
                                rs2=int(test_text[3][0:])
                                rd=bin(rd).replace('0b','')
                                while(len(rd)<5):
                                    rd="0"+rd
                                rs1=bin(rs1).replace('0b','')
                                while(len(rs1)<5):
                                    rs1="0"+rs1
                                rs2=bin(rs2).replace('0b','')
                                while(len(rs2)<12):
                                    rs2="0"+rs2
                                resultado=rs2+rs1+funct3bne+rd+opcodebe
                                final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                                final=final.replace('0x','')
                                pyscript.write("resultado",final)
                            else:
                                pass
                        else:
                            pass
                    else:
                        pass
                elif(test_text[0]=="jal"):
                    if(test_text[1][0]=="x" and (int(test_text[2][0:])!=0 or int(test_text[2][0:])==0)):
                        rd=int(test_text[1][1:])
                        rd=bin(rd).replace('0b','')
                        immediate=int(test_text[2][0:])
                        immediate=bin(immediate).replace('0b','')
                        while(len(immediate)<20):
                            immediate="0"+immediate
                        resultado=immediate+rd+opcodejal
                        final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                        final=final.replace('0x','')
                        pyscript.write("resultado",final)
                    else:
                        pass
                elif(test_text[0]=="jalr"):
                    if(test_text[1][0]=="x"):
                        rd=int(test_text[1][1:])
                        sig=test_text[2].find('x')
                        if(test_text[2][sig]=="x"):
                            rs1=int(test_text[2][sig+1:])
                            immediate=int(test_text[2][0:sig])
                            rd=bin(rd).replace('0b','')
                            while(len(rd)<5):
                                rd="0"+rd
                            rs1=bin(rs1).replace('0b','')
                            while(len(rs1)<5):
                                rs1="0"+rs1
                            immediate=bin(immediate).replace('0b','')
                            while(len(immediate)<12):
                                immediate="0"+immediate
                            resultado=immediate+rs1+funct3+rd+opcodejalr
                            final=hex(int(resultado[0:4],2))+hex(int(resultado[5:8],2))+hex(int(resultado[9:12],2))+hex(int(resultado[13:16],2))+hex(int(resultado[17:20],2))+hex(int(resultado[21:24],2))+hex(int(resultado[25:28],2))+hex(int(resultado[29:32],2))
                            final=final.replace('0x','')
                            pyscript.write("resultado",final)
                        else:
                            pass
                    else:
                        pass
            except:
                pass
    </py-script>
    <div class="container text-center p-5">
        <h1 class="text-center">
            Traductor RISC-V a Binario
        </h1>
        <p><h2>Ejemplos de instrucciones</h2></p>
        <p><h2>add x0,x1,x2</h2></p>
        <p><h2>sub x0,x1,x2</h2></p>
        <p><h2>ld x1,1000(x2)</h2></p>
        <p><h2>sd x1,1000(x2)</h2></p>
        <p><h2>jalr x1,0(x2)</h2></p>
        <p><h2>jal x1,0</h2></p>
        <p><h2>beq x0,x0,4</h2></p>
        <p><h2>bne x0,x0,4</h2></p>
        <p><h3>Ingrese una instrucción:</h3></p>
        <input id="test-input" type="text"/>
        <button id="test-button" pys-onclick="Traducir">Traducir</button>
        <p id="test-output" type=""></p>
        <p>
        <h4>Traducción en consola -></h4>
        </p>
    </div>
</body>
</html>